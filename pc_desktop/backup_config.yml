---
- name: Backup ssh configs/minio client config
  hosts: pc
  become: false
  vars:
    backup_file: "/tmp/config-backup.tar.gz"
    remote_backup_file: "local/server-backup/arch-config-backup.tar.gz"

  tasks:
    - name: Package configs
      command:
        cmd: |
          tar -czvf  {{ backup_file }}
          -C ~/
          .ssh
          .mcli
          .gitconfig
          .ideavimrc
          .gnupg/
          .ansible.cfg
          .config/fish
          .config/nvim
          .config/conky
          .config/fish
          .config/bspwm
          .config/sxhkd
          .config/picom
          .config/polybar
          .config/wireguard
          .config/alacritty
          .config/rofi
          .local/share/rofi/

    - name: Upload backup file to minio
      command:
        cmd: "mcli cp {{ backup_file }} {{ remote_backup_file }}"

    - name: Remove temporary archive file
      file:
        path: "{{ backup_file }}"
        state: absent
